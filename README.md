# GrabTheSite

一个 Python 工具，用于将网站抓取并保存到本地，支持离线浏览。

## 项目简介

GrabTheSite 是一个轻量级的网站抓取工具，能够将指定网站的内容下载到本地，并智能处理相关链接，使您可以在离线环境中浏览网站。

## 初始版本原型0

### 功能说明

- 下载固定网站：`https://www.mir.com.my/rb/photography/`
- 保存路径：`output/网站名称`
- 保留原始文件名
- 下载深度：1
- 下载文件上限：10
- 智能链接处理：
  - 只下载起始目录及其子目录下的内容
  - 对于基础目录之上的链接，保留原始链接
  - 自动转换已下载页面的链接为本地路径
- 日志系统：
  - 支持控制台日志和文件日志
  - 详细的日志输出，包括时间戳、模块名、日志级别等
  - 日志文件自动轮转，防止文件过大
- 排除列表：
  - 支持指定不需要下载的URL及其子目录
  - 初始排除列表包含：`https://www.mir.com.my/rb/photography/ftz/`

### 实现步骤

1. 创建项目基础结构，包括主脚本和目录结构
2. 实现配置管理模块，设置默认参数
3. 开发核心抓取模块，实现网页内容的获取和解析
4. 实现文件下载功能，保存到指定目录并保留原始文件名
5. 添加深度控制和文件数量限制逻辑
6. 实现智能链接处理，只处理起始目录及其子目录下的链接
7. 添加日志系统，支持控制台日志和文件日志
8. 测试完整的抓取流程，确保功能正常
9. 添加错误处理逻辑，提高程序稳定性
10. 实现排除列表功能，跳过指定URL及其子目录的下载

### 注意事项

- 此版本为初始原型，不接受命令行参数
- 所有配置参数均硬编码在代码中
- 仅支持抓取指定网站
- 只下载起始目录及其子目录下的内容，基础目录之上的链接将保留原始状态

## 配置文件支持

### 配置文件结构

项目使用 YAML 格式的配置文件，位于 `config/` 目录下：

- **config/default.yaml** - 默认配置文件，包含所有默认配置项
- **config/config.yaml** - 用户配置文件，用于覆盖默认配置

### 配置项说明

```yaml
# 目标网站配置
target_url: "https://www.mir.com.my/rb/photography/"

# 抓取参数配置
crawl:
  max_depth: 1          # 最大抓取深度
  max_files: 10         # 最大文件数量
  delay: 1              # 请求间隔（秒）
  random_delay: true    # 是否使用随机延迟
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

# 输出配置
output:
  base_dir: "output"     # 基础输出目录
  site_name: "www.mir.com.my"  # 网站名称（用于创建子目录）

# 排除列表
exclude:
  - "https://www.mir.com.my/rb/photography/ftz/"  # 排除的URL及其子目录

# 日志配置
logging:
  level: "INFO"         # 日志级别
  file: "logs/grabthesite.log"  # 日志文件路径
  max_bytes: 10485760   # 日志文件最大字节数（10MB）
  backup_count: 5       # 保留的日志文件数量
```

### 配置优先级

1. **用户配置文件** (`config/config.yaml`) - 最高优先级
2. **默认配置文件** (`config/default.yaml`) - 中等优先级
3. **硬编码配置** (`config.py`) - 最低优先级，作为备用

### 如何修改配置

1. 复制 `config/config.yaml` 文件（如果不存在）
2. 编辑 `config/config.yaml` 文件，取消注释并修改需要的配置项
3. 保存文件并重新运行程序

### 注意事项

- 不需要修改的配置项可以保持注释状态，将使用默认值
- 配置文件格式必须是有效的 YAML 格式
- 配置项的值必须符合预期类型（如深度和文件数量必须为整数）

## 功能规划

### 近期计划（版本1.0）

1. **命令行参数支持**
   - 允许用户通过命令行指定目标URL、深度、文件数量等参数
   - 支持帮助信息和参数验证

2. **配置文件支持** (已实现)
   - 使用YAML配置文件管理参数
   - 支持默认配置和用户自定义配置
   - 配置文件自动加载和合并

3. **多线程/多进程支持**
   - 实现并行抓取，提高抓取速度
   - 支持线程数/进程数配置

4. **断点续传功能**
   - 在抓取中断后可以继续之前的抓取
   - 记录已下载的文件，避免重复下载

5. **爬虫延迟设置**
   - 支持设置请求间隔，避免对目标服务器造成过大压力
   - 支持随机延迟，模拟真实用户行为

### 中期计划（版本2.0）

6. **自定义用户代理**
   - 支持设置自定义User-Agent
   - 支持随机User-Agent轮换

7. **JavaScript渲染支持**
   - 使用Selenium或Pyppeteer支持动态加载的内容
   - 可配置是否启用JavaScript渲染

8. **高级排除列表**
   - 支持正则表达式匹配
   - 支持包含列表和排除列表

9. **代理支持**
   - 支持HTTP和HTTPS代理
   - 支持代理认证

10. **站点地图生成**
    - 生成抓取内容的站点地图
    - 支持XML和HTML格式

### 长期计划（版本3.0+）

11. **压缩功能**
    - 支持压缩下载的内容，节省空间
    - 支持ZIP、TAR等格式

12. **增量抓取**
    - 只抓取更新的内容
    - 支持基于时间戳或ETag的判断

13. **高级错误处理**
    - 更完善的错误处理和重试机制
    - 支持自定义重试策略

14. **自定义文件命名规则**
    - 支持根据用户需求命名文件
    - 支持模板化命名

15. **多格式输出**
    - 支持MHTML、WARC等格式
    - 支持导出为静态网站生成器格式

16. **GUI界面**
    - 开发简单的图形界面
    - 支持拖拽操作和实时预览

17. **插件系统**
    - 支持自定义插件扩展功能
    - 提供插件开发API

18. **国际化支持**
    - 支持多语言界面
    - 支持不同地区的编码处理
