# 配置文件支持功能规划

## 1. 配置文件格式选择

选择 **YAML** 作为配置文件格式，理由如下：

* 可读性好，结构清晰

* 支持注释，方便用户理解

* 支持嵌套结构，适合复杂配置

* 广泛使用，生态成熟

## 2. 配置文件结构设计

### 基本配置结构

```yaml
# 目标网站配置
target_url: "https://www.mir.com.my/rb/photography/"

# 抓取参数配置
crawl:
  max_depth: 1
  max_files: 10
  delay: 1  # 请求间隔（秒）
  random_delay: true  # 是否使用随机延迟
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

# 输出配置
output:
  base_dir: "output"
  site_name: "www.mir.com.my"
  # 完整输出路径将自动计算为：output/www.mir.com.my

# 排除列表
exclude:
  - "https://www.mir.com.my/rb/photography/ftz/"
  # 可以添加更多排除的URL

# 日志配置
logging:
  level: "INFO"
  file: "logs/grabthesite.log"
  max_bytes: 10485760  # 10MB
  backup_count: 5
```

## 3. 配置加载和验证逻辑

### 实现步骤

1. **创建默认配置文件**：`config/default.yaml`，包含所有默认配置

2. **创建用户配置文件**：`config/config.yaml`，用户可以自定义配置

3. **实现配置加载模块**：

   * 首先加载默认配置

   * 然后加载用户配置，覆盖默认配置

   * 验证配置参数的有效性

   * 计算派生配置（如完整输出路径）

4. **配置验证**：

   * 检查必填项是否存在

   * 验证参数类型是否正确

   * 验证参数值是否合理（如深度和文件数量必须为正整数）

## 4. 代码修改方案

### 修改 `config.py`

* 保留原有硬编码配置作为备用

* 添加配置文件加载逻辑

* 实现配置合并和验证功能

* 导出最终配置对象

### 修改 `grab_the_site.py`

* 从配置模块导入配置，而不是直接使用硬编码值

### 修改 `crawler/crawl_site.py`

* 支持从配置中读取排除列表

* 支持从配置中读取抓取参数

### 修改 `crawler/save_site.py`

* 支持从配置中读取输出路径

## 5. 配置优先级

1. **用户配置文件** (`config/config.yaml`) - 最高优先级
2. **默认配置文件** (`config/default.yaml`) - 中等优先级

## 6. 错误处理

* 配置文件不存在时，使用默认配置

* 配置文件格式错误时，抛出明确的错误信息

* 配置参数无效时，使用默认值并给出警告

## 7. 文档更新

* 在 README.md 中添加配置文件使用说明

* 提供配置文件示例和参数说明

* 说明配置优先级和错误处理机制

## 8. 测试计划

* 测试默认配置加载

* 测试用户配置覆盖

* 测试配置验证

* 测试错误处理

* 测试完整抓取流程

## 9. 预期效果

* 用户可以通过编辑配置文件来自定义抓取参数

* 配置文件结构清晰，易于理解和修改

* 支持灵活的配置覆盖机制

* 提供详细的错误信息和警告

* 保持向后兼容性，确保现有功能不受影响

